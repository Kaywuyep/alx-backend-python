#!/bin/bash

# Deploy blue and green versions and check green logs

set -e

echo "ğŸš€ Applying blue deployment..."
kubectl apply -f blue_deployment.yaml

echo "ğŸš€ Applying green deployment..."
kubectl apply -f green_deployment.yaml

echo "â³ Waiting for green pods to be ready..."
sleep 15

echo "ğŸ“¦ Checking pods..."
kubectl get pods -l app=messaging-app-green

echo "ğŸ” Showing logs for green pod..."
POD_NAME=$(kubectl get pods -l app=messaging-app-green -o jsonpath="{.items[0].metadata.name}")
kubectl logs "$POD_NAME"

echo "âœ… Done. Now switch service selector in 'kubeservice.yaml' to cut over to green:"
echo "    app: messaging-app-green"
